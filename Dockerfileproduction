FROM node:alpine

# How to build:
# docker build -t registry.eduix.fi/library/localization-frontend:$(git rev-list HEAD --count) . -f Dockerfileproduction

WORKDIR /home/node/app

# Proxy:
COPY ./production/index.js .
COPY ./production/package.json .
RUN sed -i 's/restapi:28881/restapi:8080/g' index.js
RUN yarn install && yarn audit fix 

# React App:
COPY ./frontend ./frontend
RUN cd frontend && yarn install && yarn build && cp -r build /home/node/app/. && cd .. && rm -rf frontend && rm -rf /usr/local/share/.cache/yarn/

USER node
CMD ["yarn","start"]
